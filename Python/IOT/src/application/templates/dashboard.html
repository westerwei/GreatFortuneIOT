<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="IOT Cloud Platform">
    <meta name="author" content="Wester">

    <title>Great-Fortune IOT Cloud Platform</title>

    <!-- Bootstrap Core CSS -->
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="{{ url_for('static', filename='css/metisMenu.min.css') }}" rel="stylesheet">

    <!-- Timeline CSS -->
    <link href="{{ url_for('static', filename='css/timeline.css') }}" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="{{ url_for('static', filename='css/sb-admin-2.css') }}" rel="stylesheet">

    <!-- Morris Charts CSS -->
    <link href="{{ url_for('static', filename='css/morris.css') }}" rel="stylesheet">
	
    <!-- Custom Fonts -->
    <link href="{{ url_for('static', filename='css/font-awesome.min.css') }}" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	<style type="text/css">
	@import url(//fonts.googleapis.com/css?family=Yanone+Kaffeesatz:400,700);
	@import url('{{ url_for('static', filename='cubism.css') }}');
			
	#series { min-height: 155px; }
	
	.panel-yellow-text {
    	color: #f0ad4e;
	}
	
	.panel-primary-text {
    	color: #337ab7;
	}
	
	.panel-green-text {
    	color: #5cb85c;
	}
	
	.panel-huge-text {
		font-size: 60px;
	}
	
	#dimmerContainer {
        float: center;  
    	z-index: 9000;
    	position: absolute; /*newly added*/
    	right: 10%; /*newly added*/
    	top: 15%;
    	width: 80%;
    	height: 70%;
        text-align: center;
        /*background:#000;
		    opacity:0.5;
		*/
		display:none;
    	
    }
	
	#dimmerBackground {
        position: absolute; /*newly added*/
    	right: 0px; /*newly added*/
    	top: 0px;
    	width: 100%;
    	height: 100%;
        text-align: center;
        background:#000;
		    opacity:0.5;
		
    	
    }
    
    #dimmerVideo{
    	position: absolute; /*newly added*/
    	right: 5%; /*newly added*/
    	top: 5%;
    	width: 90%;
    	height: 90%;
        text-align: center;
    }
	</style>
	<!-- Enable AngularJS -->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.9/angular.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.9/angular-animate.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.9/angular-route.js"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/dashboard_controller.js') }}"></script>
    
    <script type="text/javascript" src="{{ url_for('static', filename='js/appconstants.js') }}"></script>
</head>

<body onclick="closeResource()">
    <div id="dimmerContainer" class="container theme-showcase">
    	<div id="dimmerBackground">
    		
    	</div>
    	<div id="dimmerVideo">
    		<video class="img-thumbnail" width="550" height="550" data-holder-rendered="true" controls id="videoTag"><source id="sourceTag" src="#" type="video/mp4">Your browser does not support the video tag.</video>
    	</div>
    	
    </div>
    <div id="wrapper" ng-app="dashboard-page" ng-controller="DashboardController">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header"  id='navheader' style="Display: none;">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/index.html#/">Great-Fortune Internet of Things Cloud Platform</a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right" id="navmenu" style="Display: none;">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-envelope fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-messages">
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <strong>John Smith</strong>
                                    <span class="pull-right text-muted">
                                        <em>Yesterday</em>
                                    </span>
                                </div>
                                <div>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque eleifend...</div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>Read All Messages</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-messages -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-tasks fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-tasks">
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 1</strong>
                                        <span class="pull-right text-muted">40% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40% Complete (success)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 2</strong>
                                        <span class="pull-right text-muted">20% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                            <span class="sr-only">20% Complete</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 3</strong>
                                        <span class="pull-right text-muted">60% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                            <span class="sr-only">60% Complete (warning)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <p>
                                        <strong>Task 4</strong>
                                        <span class="pull-right text-muted">80% Complete</span>
                                    </p>
                                    <div class="progress progress-striped active">
                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                            <span class="sr-only">80% Complete (danger)</span>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Tasks</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-tasks -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-comment fa-fw"></i> New Comment
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                    <span class="pull-right text-muted small">12 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> Message Sent
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-tasks fa-fw"></i> New Task
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="#">
                                <div>
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a class="text-center" href="#">
                                <strong>See All Alerts</strong>
                                <i class="fa fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                    <!-- /.dropdown-alerts -->
                </li>
                <!-- /.dropdown -->
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="#"><i class="fa fa-user fa-fw"></i> User Profile</a>
                        </li>
                        <li><a href="#"><i class="fa fa-gear fa-fw"></i> Settings</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="login.html"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation" id="navside" style="Display: none;">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                            </div>
                            <!-- /input-group -->
                        </li>
                        <li>
                            <a href="/iotapp/admin/dashboard"><i class="fa fa-dashboard fa-fw"></i> Dashboard</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-bar-chart-o fa-fw"></i> Devices Management<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="/iotapp/admin/device">Register Device</a>
                                </li>
                                <li>
                                    <a href="#">Device Monitoring</a>
                                </li>
                            </ul>
                            <!-- /.nav-second-level -->
                        </li>
                        <!--   
                        <li>
                            <a href="tables.html"><i class="fa fa-table fa-fw"></i> Tables</a>
                        </li>
                        <li>
                            <a href="forms.html"><i class="fa fa-edit fa-fw"></i> Forms</a>
                        </li>
                        <li>
                            <a href="#"><i class="fa fa-wrench fa-fw"></i> UI Elements<span class="fa arrow"></span></a>
                            <ul class="nav nav-second-level">
                                <li>
                                    <a href="panels-wells.html">Panels and Wells</a>
                                </li>
                                <li>
                                    <a href="buttons.html">Buttons</a>
                                </li>
                                <li>
                                    <a href="notifications.html">Notifications</a>
                                </li>
                                <li>
                                    <a href="typography.html">Typography</a>
                                </li>
                                <li>
                                    <a href="icons.html"> Icons</a>
                                </li>
                                <li>
                                    <a href="grid.html">Grid</a>
                                </li>
                            </ul> -->
                            <!-- /.nav-second-level -->
                        <!--  </li> -->
                        
                        
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">Dashboard</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-4 col-md-6">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <!-- <i class="fa fa-comments fa-5x"></i>-->
                                    <span id="TEMServiceCContainer"></span>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="panel-huge-text"><span id='tempcdegree'>0</span>&deg;C</div>
                                    <div></div>
                                </div>
                            </div>
                        </div>
                        
                            <div class="panel-footer panel-primary-text">
                                <span class="pull-left">Temperature</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="panel panel-green">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <!--  <i class="fa fa-tasks fa-5x"></i>-->
                                    <span id="TEMServiceFContainer"></span>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="panel-huge-text"><span id='tempfdegree'>31</span>&deg;F</div>
                                    <div></div>
                                </div>
                            </div>
                        </div>
                        
                            <div class="panel-footer panel-green-text">
                                <span class="pull-left">Temperature</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="panel panel-yellow">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <!--  <i class="fa fa-shopping-cart fa-5x"></i>  -->
                                    <span id="HUMServiceContainer"></span>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="panel-huge-text"><span id='humidityVal'>0</span>%</div>
                                    <div></div>
                                </div>
                            </div>
                        </div>
                        
                            <div class="panel-footer panel-yellow-text">
                                <span class="pull-left">Humidity</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        
                    </div>
                </div>
                <!--  
                <div class="col-lg-3 col-md-6">
                    <div class="panel panel-red">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-support fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <div class="huge">13</div>
                                    <div>Support Tickets!</div>
                                </div>
                            </div>
                        </div>
                        <a href="#">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                -->
            </div>
            <!-- /.row -->
            <div class="row">
            	<div class="col-lg-12">
            		<div class="panel panel-red">
                        <div class="panel-heading">
                            <i class="fa fa-bar-chart-o fa-fw"></i> Timeline of Temperature & Humidity
                            <div class="pull-right">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
                                        Actions
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu pull-right" role="menu">
                                        <li><a href="#">Action</a>
                                        </li>
                                        <li><a href="#">Another action</a>
                                        </li>
                                        <li><a href="#">Something else here</a>
                                        </li>
                                        <li class="divider"></li>
                                        <li><a href="#">Separated link</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <!-- <div id="morris-area-chart"></div> -->
                            <div id="body">
                            	<div id="series"></div>
                            </div>
                        </div>
                        <!-- /.panel-body -->
                    </div>
            	</div>
            </div>
            <!-- /.row -->
            <div class="row">
            	<div class="col-lg-12">
            		<div class="panel panel-default">
                        <div class="panel-heading">
                            Registered Devices
                        </div>
                        <!-- /.panel-heading -->
                        <div class="panel-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                    	<tr>
                                        	<th>Device ID</th>
                                            <th>Vendor</th>
                                            <th>Location</th>
                                            <th>Device Type</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        	            <tr ng-animate="'rowanimate'" ng-repeat="device in deviceList">
                	                        <td>{{'{{'}}device.deviceSerialNO{{'}}'}}</td>
                                            <td>{{'{{'}}device.deviceVendor{{'}}'}}</td>
                                            <td>{{'{{'}}device.deviceLocation{{'}}'}}</td>
                                            <td>{{'{{'}}device.deviceType{{'}}'}}</td>
                                            <td>{{'{{'}}device.status{{'}}'}}</td>
                                    	</tr>
                                                
                                    </tbody>
                                </table>
                            </div>
                            <!-- /.table-responsive -->
                        </div>
                        <!-- /.panel-body -->
                    </div>
                </div>    
            </div>        
            <!-- /.row -->
            <div class="row">
                <a name="videoListAnchor"></a>
            	<div class="col-lg-12">
            		<div class="panel panel-primary">
                        <div class="panel-heading">
                            Video List
                        </div>
                        <p></p>
            			<div id="videoContainer" >
            			</div>
            		</div>
            	</div>
            </div>
            <!-- /.row -->
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script type="text/javascript" src="{{ url_for('static', filename='jquery-2.1.1.js') }}"></script>

    <!-- Bootstrap Core JavaScript -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/metisMenu.min.js') }}"></script>

    <!-- Morris Charts JavaScript -->
    <!--  
    <script type="text/javascript" src="{{ url_for('static', filename='js/raphael-min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/morris.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/morris-data.js') }}"></script>
	-->
	
    <!-- Custom Theme JavaScript -->
    <script type="text/javascript" src="{{ url_for('static', filename='js/sb-admin-2.js') }}"></script>
    
    <script src="http://d3js.org/d3.v3.js" charset="utf-8"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='gauge.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='mqttws31.js') }}"></script>
	
	<script type="text/javascript" src="{{ url_for('static', filename='cubism.v1.js') }}"></script>
	<script type="text/javascript" src="{{ url_for('static', filename='highlight.min.js') }}"></script>
	
	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap-theme.min.css">
	
	
    
	<script>
						
				
			var gauges = [];
			var wsSensorConn;
			var wsMediaConn;
			//var remoteHostIP = "192.168.1.101";
			//var remoteHostIP = "172.20.10.7";
			
			function closeResource(){
				$( "#dimmerContainer" ).fadeOut("slow");
			}
			
			function playVideo(videoUrl){
				$('#videoTag').get(0).pause();
				$('#sourceTag').attr('src', videoUrl);
				$('#videoTag').get(0).load();
				$('#videoTag').get(0).play();
			}
			
			function getDeviceMediaFiles(){
	    	  //var url = "http://192.168.1.11:1151/user_device/" + selectedPhoneNum + "/mediadata"
	    	  var url = "http://" + remoteHostIP + ":6190/iotapp/mediadata/18721687597?limit=10";
	    	  $.ajax({
	    		  type: "GET",
		          url: url
		      }).then(function(data) {
		         //$('.greeting-id').append(data.id);
		         //$('.greeting-content').append(data.content);
		         console.log(data.length);
		         var mediaDiv;
		         for(var i = 0; i< data.length; i++){
		        	 console.log(data[i].mediaFile);
			         console.log(data[i].mediaType);
			         console.log('----------------');	
			         
			         if(data[i].mediaType == 'pic' ){
			        	//mediaDiv = "<div class='well'><div><img data-src='holder.js/200x200' class='img-thumbnail' alt='" + data[i].mediaFile + 
			        	//"' src='http://192.168.1.11:1151/user_device/" + selectedPhoneNum + "/mediadata/" + data[i].mediaFile + 
			        	////"' data-holder-rendered='true' style='width: 100px; height: 100px;'> <a href='http://192.168.1.11:1151/user_device/" + selectedPhoneNum + "/mediadata/" + data[i].mediaFile +"' target='_blank'>" + data[i].mediaFile + "</a></div></div>";
			        	//"' data-holder-rendered='true' style='width: 100px; height: 100px;'> <a href='javascript:dim(true)'>" + data[i].mediaFile + "</a></div></div>";
			        	
			        	mediaDiv = "<div class='well' style='margin-left: 20px;margin-right: 20px'><div><img data-src='holder.js/200x200' class='img-thumbnail' alt='" + data[i].mediaFile + 
			        	"' src='http://" + remoteHostIP + ":6190/iotapp/mediadata/18721687597/" + data[i].mediaFile + 
			        	"' data-holder-rendered='true' style='width: 300px; height: 300px;'> <a href='javascript:dim(true)'>" + data[i].mediaFile + "</a></div></div>";
			        	
			        	$('#photoContainer').html($('#photoContainer').html() + mediaDiv);
			         }
			         else{
			        	  
			        	  mediaDiv = "<div class='well' style='margin-left: 20px;margin-right: 20px' ><div >" + 
				        	 "<video class='img-thumbnail' width='300' height='300' data-holder-rendered='true'  ><source src='http://" + remoteHostIP + ":6190/iotapp/mediadata/18721687597/" + data[i].mediaFile + 
					         "' type='video/mp4'>" + 
							 "Your browser does not support the video tag.</video>" +
							 "<a href='#'>" + data[i].mediaFile + "</a>" + 
				        	  "</div></div>";
			        	  
			        	 $('#videoContainer').html($('#videoContainer').html() + mediaDiv); 
			         }
		         }
		      });   
	        }
			
			function addMediaToContainer(container, mediaData){
		    	  $(mediaData)
				    .hide()
		        	.css('opacity',0.0)
			        .prependTo('#' + container)
			        .slideDown('slow')
			        .animate({opacity: 1.0});
		    }
			
			function checkMediaWSConn(){
		    	  
		    	  console.log("Start to check Media notification Web Socket connection....");
		    	  //connection = new WebSocket('ws://192.168.1.11:1150/websocket/addmedia');
		    	  wsMediaConn = new WebSocket('ws://' + remoteHostIP + ':1150/iotapp/ws/addmedia');
		    	  // When the connection is open, send some data to the server
		    	  wsMediaConn.onopen = function () {
		    		  wsMediaConn.send('ping'); // Send the message 'Ping' to the server
		    	    //alert("Connection has been created!");
		    	  };
		
		    	  // Log errors
		    	  wsMediaConn.onerror = function (error) {
		    	    console.log('WebSocket Error ' + error);
		    	  };
		
		    	  // Log messages from the server
		    	  wsMediaConn.onmessage = function (e) {
		    	      if(e.data === "ping_ok" ){
		    	    	  console.log("Web Socket connection for media add notify runs normal: " + e.data);
		    	    	  //alert("Call back: " + e.data);
		    	      }
		    	      else{
		    	        //console.log("Get data: " + e.data);
		    	        var mediaData = $.parseJSON(e.data);
		    	        //var svcType = deviceData.serviceType;
		    	        //var date = new Date(deviceData.timestamp.$date)
		    	        console.log("check Media obj: " + mediaData.deviceSerialNO + " : " + mediaData.mediaType + " : " + mediaData.mediaFile);
		    	        
		    	        var videoUrl = "http://" + remoteHostIP + ":6190/iotapp/mediadata/18721687597/" + mediaData.mediaFile;
		    	        
		    	        if(mediaData.mediaType == "pic"){
		    	        	
				        	mediaDiv = "<div class='well' style='margin-left: 20px;margin-right: 20px'><div><img data-src='holder.js/200x200' class='img-thumbnail' alt='" + mediaData.mediaFile + 
				        	"' src='http://" + remoteHostIP + ":6190/iotapp/mediadata/18721687597/" + mediaData.mediaFile + 
				        	"' data-holder-rendered='true' style='width: 300px; height: 300px;'> <a href='javascript:dim(true)'>" + mediaData.mediaFile + "</a></div></div>";
				        	
		    	        	addMediaToContainer("photoContainer", mediaDiv);
		    	        }
		    	        else{
		    	        	 location.hash = "#videoListAnchor"; 
				        	    mediaDiv = "<div class='well' style='margin-left: 20px;margin-right: 20px' ><div >" + 
						        	 "<video class='img-thumbnail' width='300' height='300' data-holder-rendered='true'  ><source src='http://" + remoteHostIP + ":6190/iotapp/mediadata/18721687597/" + mediaData.mediaFile + 
							         "' type='video/mp4'>" + 
									 "Your browser does not support the video tag.</video>" +
									 "<a href='#'>" + mediaData.mediaFile + "</a>" + 
						        	  "</div></div>";
		    	        	addMediaToContainer("videoContainer", mediaDiv);
		    	        }
		    	        
		    	        setTimeout(function(){
		    	        	$("#dimmerContainer").center(false);
			    	        $( "#dimmerContainer" ).fadeIn("slow");
				    	    playVideo(videoUrl);	
		    	        }, 2000);
		    	        
			    	    
		    	      }
		    	      
		    	      
		    		    
		    	  };
		    	  
		      }
			
			function checkSensorWSConn(){
		    	  
		    	  console.log("Start to check Sensor notification Web Socket connection....");
		    	  //connection = new WebSocket('ws://192.168.1.11:1150/websocket/addmedia');
		    	  wsSensorConn = new WebSocket('ws://' + remoteHostIP + ':1150/iotapp/ws/devicedatanotify');
		    	  // When the connection is open, send some data to the server
		    	  wsSensorConn.onopen = function () {
		    		  wsSensorConn.send('ping'); // Send the message 'Ping' to the server
		    	    //alert("Connection has been created!");
		    	  };
		
		    	  // Log errors
		    	  wsSensorConn.onerror = function (error) {
		    	    console.log('WebSocket Error ' + error);
		    	  };
		
		    	  // Log messages from the server
		    	  wsSensorConn.onmessage = function (e) {
		    	      if(e.data === "ping_ok" ){
		    	    	  console.log("Web Socket connection for device data notification runs normal: " + e.data);
		    	    	  //alert("Call back: " + e.data);
		    	      }
		    	      else{
		    	        //console.log("Get data: " + e.data);
		    	        var deviceData = $.parseJSON(e.data);
		    	        var svcType = deviceData.serviceType;
		    	        var date = new Date(deviceData.timestamp.$date)
		    	        //console.log("check JSON obj: " + deviceData.timestamp.$date + " : " + date.toUTCString());
		    	        
		    	        if(svcType === 'TEMService'){
		    	        	var tempc = Number(deviceData.DeviceData.Temperature_C);
		    	        	$('#tempcdegree').text(Math.round(tempc));
		    	        	var tempf = Number(deviceData.DeviceData.Temperature_F);
		    	        	$('#tempfdegree').text(Math.round(tempf));
		    	        	//console.log("Temp C: " + tempc);
		    	        	updateGauges(svcType + 'C', tempc);
		    	        	//console.log("Temp F: " + tempf);
		    	        	updateGauges(svcType + 'F', tempf);
		    	        }
		    	        else if(svcType === 'HUMService'){
		    	        	var humidity = Number(deviceData.DeviceData.Humidity);
		    	        	//console.log("Humidity: " + humidity);
		    	        	updateGauges(svcType, humidity);
		    	        	$('#humidityVal').text(Math.round(humidity));
		    	        }
		    	        
		    	      }
		    		    
		    	  };
		    	  
		      }
			
			function createGauge(name, label, min, max, fontSize)
			{
				var config = 
				{
					size: 150,
					label: label,
					min: undefined != min ? min : 0,
					max: undefined != max ? max : 100,
					minorTicks: 5,
					fontSize: undefined != fontSize ? fontSize : 13
				}
				
				var range = config.max - config.min;
				config.yellowZones = [{ from: config.min + range*0.75, to: config.min + range*0.9 }];
				config.redZones = [{ from: config.min + range*0.9, to: config.max }];
				
				gauges[name] = new Gauge(name + "Container", config);
				gauges[name].render();
			}
			
			function createGauges()
			{
				createGauge("TEMServiceC", "", 0, 60, 13);
				createGauge("TEMServiceF", "", 31, 140, 13);
				createGauge("HUMService", "", 0, 100, 9 );
				//createGauge("test", "Test", -50, 50 );
			}
			
			function updateGauges(key, value)
			{
				gauges[key].redraw(value);
				/* 
				for (var key in gauges)
				{
					var value = getRandomValue(gauges[key])
					gauges[key].redraw(value);
				}
				 */
			}
			
			/* 
			function getRandomValue(gauge)
			{
				var overflow = 0; //10;
				return gauge.config.min - overflow + (gauge.config.max - gauge.config.min + overflow*2) *  Math.random();
			}
			 */
			
			function initialize()
			{
				createGauges();
				//setInterval(updateGauges, 5000);
			}
			
			$( document ).ready(function(){
		    	console.log("document is ready~~");
		    	checkMediaWSConn();
		    	checkSensorWSConn();
		    	initialize()
		    	

				d3.select("#series").call(function(div) {
	
				  div.append("div")
				      .attr("class", "axis")
				      .call(context.axis().orient("top"));
	
				  div.selectAll(".horizon")
				      .data([tempc, tempf, humidity])
				    .enter().append("div")
				      .attr("class", "horizon")
				      .call(context.horizon().extent([10, 150]));
	
				  div.append("div")
				      .attr("class", "rule")
				      .call(context.rule());
	
				});
			    //d3.mouse(this);
		    	$( "#navheader" ).fadeToggle("slow","linear");
		    	$( "#navmenu" ).slideDown("slow");
		    	$( "#navside" ).slideDown("slow");
		    	
		    	
		    	
		    	angular.element($('#wrapper')).scope().getDeviceList('GreatFortune','Wester');
		    	angular.element($('#wrapper')).scope().$apply();
		    	
		    	getDeviceMediaFiles();
		    });
			
			
			function random(name) {
				  var value = 0,
				      values = [],
				      i = 0,
				      last;
				  return context.metric(function(start, stop, step, callback) {
				    start = +start, stop = +stop;
				    if (isNaN(last)) last = start;
				    //while (last < stop) {
				      last += step;
				      //value = Math.max(-10, Math.min(10, value + .8 * Math.random() - .4 + .2 * Math.cos(i += .2)));
				      //value = Math.max(-10, Math.min(10, value + .8 * 23 - .4 + .2 * Math.cos(i += .2)));
				      value = 0;
				      
				      if(name === 'Temperature C'){
				    	  
				    	  $.getJSON(url + 'tempc')
				    		    .done(function( data ) {
				    		    	tempcVal = data.value
				    		    });
				    		
				    	  
				    	  value = tempcVal;
				      }
				      else if(name === 'Temperature F'){
				    	  $.getJSON(url + 'tempf')
			    		    .done(function( data ) {
			    		    	tempfVal = data.value
			    		    });
				    	  
				    	  value = tempfVal;
				      }
				      else if(name === 'Humidity(%)'){
				    	  $.getJSON(url + 'humidity')
			    		    .done(function( data ) {
			    		    	humidityVal = data.value
			    		    });
				    	  value = humidityVal;
				      }
				      //console.log("Value: " + value);  
				      values.push(value);
				    //}
				    callback(null, values = values.slice((start - stop) / step));
				  }, name);
			}
			
			var context = cubism.context()
		    .serverDelay(0)
		    .clientDelay(0)
		    .step(1e3)
		    .size(1024);

		var tempc = random("Temperature C"),
		    tempf = random("Temperature F"),
		    humidity = random("Humidity(%)");
		var tempcVal = 0, tempfVal = 31, humidityVal = 0;
		var url = "http://" + remoteHostIP + ":6190/iotapp/deviceData/";
		
		jQuery.fn.center = function(parent) {
		    if (parent) {
		        parent = this.parent();
		    } else {
		        parent = window;
		    }
		    this.css({
		        "position": "absolute",
		        "top": ((($(parent).height() - this.outerHeight()) / 2) + $(parent).scrollTop() + "px"),
		        "left": ((($(parent).width() - this.outerWidth()) / 2) + $(parent).scrollLeft() + "px")
		    });
		return this;
		}
		
		/*
		$( window ).resize(function() {
			  console.log("width: " + $( window ).width());
			});
		*/
		
		/* // Create a MQTTclient instance
		client = new Paho.MQTT.Client(remoteHostIP, Number(1883), "DashboarClient");

		// set callback handlers
		client.onConnectionLost = onConnectionLost;
		client.onMessageArrived = onMessageArrived;

		// connect the client
		client.connect({onSuccess:onConnect});


		// called when the client connects
		function onConnect() {
		  // Once a connection has been made, make a subscription and send a message.
		  console.log("onConnect");
		  client.subscribe("/refreshMediaData");
		  message = new Paho.MQTT.Message("Hello");
		  message.destinationName = "/refreshMediaData";
		  client.send(message); 
		}

		// called when the client loses its connection
		function onConnectionLost(responseObject) {
		  if (responseObject.errorCode !== 0) {
		    console.log("onConnectionLost:"+responseObject.errorMessage);
		  }
		}

		// called when a message arrives
		function onMessageArrived(message) {
		  console.log("onMessageArrived:"+message.payloadString);
		} */
		</script>

</body>

</html>
